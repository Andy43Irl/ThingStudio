{
    "widget": {
        "title": "StateButton",
        "tagName": "ts-statebutton",
        "instructions": "IMPORTANT: Work in progress! . Contact Mike.\n\nStateButton is both a command and a display widget.\nIt's designed for use where you have, say, a remote light, which may be switched on or off by more than one user.\nWhen first rendered, it enters 'unknown\" state and sends out a \"reqStatus\" message on it's publish feed. The remote device should reply with a current status - \"on\" or \"off\".\nWhen clicked, StateButton sends a toggleState message and enters \"waiting\" state, until the remote device has send a new status message.\n\nBackground color reflects state: \n-unknown - grey\n-on - green\n-off - red\n-waiting - white",
        "parameters": [
            {
                "title": "pubfeed",
                "paramType": "Feed",
                "required": true,
                "description": "Feed to publish to",
                "dummyValue": "StatePub"
            },
            {
                "title": "subfeed",
                "paramType": "Feed",
                "required": true,
                "description": "Feed to subscribe to.",
                "dummyValue": "StateSub"
            },
            {
                "title": "legend",
                "paramType": "String",
                "required": false,
                "description": "Label for button",
                "dummyValue": "Hall Light"
            }
        ],
        "widgetType": "Library Template"
    },
    "template": {
        "title": "StateButton",
        "html": "<style>\n.myButton {\n\t/*background:-webkit-gradient(linear, left top, left bottom, color-stop(0.05, #44c767), color-stop(1, #5cbf2a));*/\n\t/*background:-moz-linear-gradient(top, #44c767 5%, #5cbf2a 100%);*/\n\t/*background:-webkit-linear-gradient(top, #44c767 5%, #5cbf2a 100%);*/\n\t/*background:-o-linear-gradient(top, #44c767 5%, #5cbf2a 100%);*/\n\t/*background:-ms-linear-gradient(top, #44c767 5%, #5cbf2a 100%);*/\n\t/*background:linear-gradient(to bottom, #44c767 5%, #5cbf2a 100%);*/\n\tfilter:progid:DXImageTransform.Microsoft.gradient(startColorstr='#44c767', endColorstr='#5cbf2a',GradientType=0);\n\t-moz-border-radius:8px;\n\t-webkit-border-radius:8px;\n\tborder-radius:8px;\n\tborder:1px solid #18ab29;\n\tdisplay:inline-block;\n\tcursor:pointer;\n\tcolor:#ffffff;\n\tfont-family:Arial;\n\tfont-size:17px;\n\tpadding:16px 31px;\n\ttext-decoration:none;\n\ttext-shadow:0px 1px 0px #2f6627;\n}\n.myButton:hover {\n\t/*background:-webkit-gradient(linear, left top, left bottom, color-stop(0.05, #5cbf2a), color-stop(1, #44c767));*/\n\t/*background:-moz-linear-gradient(top, #5cbf2a 5%, #44c767 100%);*/\n\t/*background:-webkit-linear-gradient(top, #5cbf2a 5%, #44c767 100%);*/\n\t/*background:-o-linear-gradient(top, #5cbf2a 5%, #44c767 100%);*/\n\t/*background:-ms-linear-gradient(top, #5cbf2a 5%, #44c767 100%);*/\n\t/*background:linear-gradient(to bottom, #5cbf2a 5%, #44c767 100%);*/\n\tfilter:progid:DXImageTransform.Microsoft.gradient(startColorstr='#5cbf2a', endColorstr='#44c767',GradientType=0);\n}\n.myButton:active {\n\tposition:relative;\n\ttop:1px;\n}\n\n.gray {\n    background-color: gray;\n}\n\n.green {\n    background-color: green;\n}\n\n.red {\n    background-color: red;\n}\n\n.white {\n    background-color: white;\n}\n\n</style>\n\n\n\n<button  class=\" myButton {{statebuttonColor}}\">{{legend}}</button>",
        "js": "Template[name].onCreated(function() {\n    //This tracks the state of the widget\n    console.log(\"OC:\", this)\n    this.state = new ReactiveVar(\"unknown\");\n});\n\nTemplate[name].onRendered(function(){\n    //This requests an initial state from the device\n    console.log(\"TI \", this)\n    publishFeed(this.data.pubfeed, \"reqStatus\");\n    state = Template.instance().state\n    subfeed = this.data.subfeed;\n    //This hooks the state of the widget to the subscribe feed\n    Tracker.autorun(function() {\n        msg = getFeed(subfeed,  \"unknown\");\n        console.log(\"SSS \", msg, state)\n        state.set(msg);\n    });\n});\n\n\n\nTemplate[name].helpers({\n    statebuttonColor: function() {\n        //Translate the widget state to a css class.\n        console.log(\"SBC: \", Template.instance().state.get())\n        switch(Template.instance().state.get()){\n            case \"unknown\": return \"gray\";\n            case \"on\": return \"green\";\n            case \"off\": return \"red\";\n            case \"waiting\": return \"white\";\n        } \n    },\n        legend: function(){\n        l =  Template.instance().data.legend;\n        return l || \"Kitchen Light\"\n    },\n});\n\nTemplate[name].events({\n    'click button': function(ev){\n        console.log(\"ButtonClicked\", this);\n        publishFeed(Template.instance().data.pubfeed, \"toogleState\");\n        Template.instance().state.set(\"waiting\")\n        return false;\n    },\n});",
        "isWidget": true
    }
}